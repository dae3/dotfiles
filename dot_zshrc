typeset -U path fpath manpath
bindkey -e
setopt autocd

cdpath=(labs projects)

if ! [[ "$PATH" =~ "$HOME/.local/bin:$HOME/bin:" ]]
then
    PATH="$HOME/.local/bin:$HOME/bin:$PATH"
fi

# setup completions for things that might exist
COMPLETIONS=(chezmoi gh tilt kubectl kind pack podman skaffold minikube helm devpod kn)
LOCALCOMP=${HOME}/.config/completion
fpath+=${LOCALCOMP}
if [ ! -d ${LOCALCOMP} ]; then
  mkdir -p ${LOCALCOMP}
fi
for c in ${COMPLETIONS}; do
  which $c > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    if [ ! -f ${LOCALCOMP}/_$c ] || [ $(which $c) -nt ${LOCALCOMP}/_$c ]; then
      echo "Setting up completion for $c"
      ($c completion zsh > ${LOCALCOMP}/_$c) || true
    fi
  fi
done

autoload -U compinit && compinit
zstyle ':completion:*' menu select
autoload predict-on
predict-on

# aws cli completion nonsense
# https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-completion.html#cli-command-completion-linux]
if [[ -x /usr/local/bin/aws && -x /usr/local/bin/aws_completer ]]; then
  autoload bashcompinit && bashcompinit
  complete -C '/usr/local/bin/aws_completer' aws
fi

# gcloud completion nonsense
[ -d /usr/share/google-cloud-sdk ] && source /usr/share/google-cloud-sdk/completion.zsh.inc

# go completion nonsense
which go > /dev/null 2>&1
if [ $? -eq 0 ]; then
  GOCOMPLETE=${HOME}/.local/bin/gocomplete
  [ -x ${GOCOMPLETE} ] || GOBIN=${HOME}/.local/bin go install github.com/posener/complete/v2/gocomplete@v2.1.0
  autoload bashcompinit && bashcompinit
  complete -C ${GOCOMPLETE} go
fi

THEME=bubblesextra.omp.json
which oh-my-posh > /dev/null 2>&1
if [[ $? -eq 0 && -f ~/.config/${THEME} ]]; then
  eval "$(oh-my-posh init zsh --config ~/.config/${THEME})"
fi

if [ -d /home/linuxbrew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

which direnv > /dev/null 2>&1
if [ $? -eq 0 ]; then
  eval "$(direnv hook zsh)"
fi

# toolbox container name
if [ -f /run/.containerenv ]; then
  export TOOLBOXNAME=$(awk -F'"' '/^name/ { print $2 }' /run/.containerenv)
fi

# vim: ft=zsh ff=unix sw=2 ts=2 ai et
